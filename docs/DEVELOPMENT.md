# Заметки разработчика

## Архитектура решения

### Парсинг сайта
- Сайт использует React + SSR, требует полный JavaScript рендеринг
- Playwright с Chromium обязателен для корректной работы
- Нужны правильные User-Agent заголовки и ожидание загрузки

### Состояние системы
- JSON файлы для хранения предыдущего состояния
- Сравнение ID квартир для избежания дубликатов
- Раздельное состояние для каждого режима мониторинга

### Уведомления
- HTML разметка в Telegram для красивого форматирования
- Graceful handling ошибок API
- Детализированная информация в уведомлениях

## Известные особенности

### Сайт аренда.дом.рф
- Медленная загрузка (~5-10 сек для полного рендера)
- Может отдавать 0 результатов при перегрузке
- Фильтры работают через URL параметры

### Мониторинг ЖК Лайнер
- Фильтрация происходит по названию в описании
- Может не находить квартиры если они недоступны
- Название комплекса может меняться в описаниях

## Production рекомендации

### Деплой
- Использовать Docker для изоляции окружения
- Настроить restart policies для стабильности
- Мониторить логи через docker-compose logs

### Мониторинг
- Health checks через curl/requests
- Логирование всех операций с timestamp
- Alerting при длительных сбоях

### Безопасность
- Токены только через переменные окружения
- Никогда не коммитить .env файлы
- Ограничить сетевой доступ контейнера

## Возможные улучшения

### Функциональность
- [ ] Веб-интерфейс для управления
- [ ] База данных вместо JSON файлов
- [ ] Множественные чаты для уведомлений
- [ ] Фильтры по цене/району
- [ ] Интеграция с другими сайтами

### Технические
- [ ] Prometheus метрики
- [ ] Kubernetes деплой
- [ ] Circuit breaker для API
- [ ] Rate limiting для запросов
- [ ] Backup состояния в S3

## Отладка

### Проблемы с парсингом
1. Проверить доступность сайта
2. Запустить debug_parser.py
3. Проверить селекторы в браузере
4. Увеличить timeout ожидания

### Проблемы с Telegram
1. Проверить валидность токена
2. Проверить права бота в чате
3. Тестировать через test_bot.py
4. Проверить rate limits API

### Проблемы с Docker
1. Проверить health checks
2. Смотреть логи контейнера
3. Проверить переменные окружения
4. Тестировать локально без Docker
